<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>List of all books</title>
    <style type="text/css">
      body {
        padding: 50px;
      }

      label {
        display: inline-block;
        width: 100px;
      }

      input:read-only {
        background: lightgray;
      }

      .row {
        margin-top: 10px;
      }

      .books,
      .books td {
        border: 1px solid lightgray;
        padding: 5px;
      }
    </style>
    <!-- <script src="/webjars/jquery/3.3.1/jquery.min.js"></script> -->
    <script src="scripts/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <div class="row">
      <label for="holder-input">Goto:</label>
      <a th:href="@{/authors}" href="authors.html">Authors</a>
      <a th:href="@{/genres}" href="genres.html">Genres</a>
    </div>
    <hr />

    <h3>Books:</h3>
    <table class="books">
      <thead>
        <tr>
          <th>Title</th>
          <th>Genre</th>
          <th>Authors</th>
          <th>Comments</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="booksTable"></tbody>
    </table>

    <!--  Added book -->
    <form
      id="added-book-form"
      th:action="@{/books}"
      th:method="post"
      action="books.html"
    >
      <h3>Add book:</h3>

      <div class="row">
        <label for="book-title">Title:</label>
        <input id="book-title" name="title" type="text" value="" />
      </div>

      <div class="row">
        <label for="genres">Genre:</label>
        <select id="genresSelect" name="genreId">
          <option disabled selected value>-- select an genre --</option>
        </select>
      </div>

      <div class="row">
        <label for="authors">Authors:</label>
        <select id="authorsSelect" name="authorsId" multiple></select>
      </div>

      <div class="row">
        <button type="submit">Save</button>
      </div>
    </form>

    <script>
      var restServerUrl = "http://192.168.1.139:8081";

      $(function () {
        updateBooks();
        updateGenres();
        updateAuthors();
      });

      function updateGenres() {
        $.get(restServerUrl + "/api/genres").done(function (genres) {
          genres.forEach(function (genre) {
            $("#genresSelect").append(`
              <option value="${genre.id}"">${genre.name}</option>
            `);
          });
        });
      }

      function updateAuthors() {
        $.get(restServerUrl + "/api/authors").done(function (authors) {
          authors.forEach(function (author) {
            $("#authorsSelect").append(`
              <option value="${author.id}"">${author.name}</option>
            `);
          });
        });
      }

      function updateBooks() {
        $.get(restServerUrl + "/api/books").done(function (books) {
          books.forEach(function (book) {
            $("#booksTable").append(`
                <tr>
                  <td>"${book.title}"</td>
                  <td>"${book.genreName}"</td>
                  <td>"${book.authorsName}"</td>
                  <td>
                    <a href="comments.html" >Comments</a >
                  </td>
                  <td>
                    <form name="deleteBookForm" action="/api/books/${book.id}">
                      <button type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              `);
          });
        });
      }
    </script>
  </body>
</html>
